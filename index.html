import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, serverTimestamp } from 'firebase/firestore';

// Firebase configuration and app ID (provided by the Canvas environment)
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

function App() {
    const [currentSection, setCurrentSection] = useState('home');
    const [db, setDb] = useState(null);
    const [auth, setAuth] = useState(null);
    const [userId, setUserId] = useState(null);
    const [isAuthReady, setIsAuthReady] = useState(false);
    const [quizAnswers, setQuizAnswers] = useState({ q1: null, q2: null, q3: null });
    const [showQuizResult, setShowQuizResult] = useState(false);
    const canvasRef = useRef(null);
    const [isDrawing, setIsDrawing] = useState(false);
    const [drawingColor, setDrawingColor] = useState('#00ff00'); // Default drawing color: bright green

    // Initialize Firebase and set up authentication listener
    useEffect(() => {
        try {
            const app = initializeApp(firebaseConfig);
            const firestore = getFirestore(app);
            const firebaseAuth = getAuth(app);

            setDb(firestore);
            setAuth(firebaseAuth);

            const unsubscribe = onAuthStateChanged(firebaseAuth, async (user) => {
                if (user) {
                    setUserId(user.uid);
                    setIsAuthReady(true);
                    console.log("Firebase authenticated user:", user.uid);
                } else {
                    // Sign in anonymously if no token is provided or user logs out
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(firebaseAuth, initialAuthToken);
                            console.log("Signed in with custom token.");
                        } else {
                            await signInAnonymously(firebaseAuth);
                            console.log("Signed in anonymously.");
                        }
                    } catch (error) {
                        console.error("Firebase authentication error:", error);
                    }
                }
            });

            return () => unsubscribe();
        } catch (error) {
            console.error("Failed to initialize Firebase:", error);
        }
    }, []);

    // Graffiti Canvas Drawing Logic
    useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = 5;

        const getCoords = (e) => {
            const rect = canvas.getBoundingClientRect();
            if (e.touches) {
                return {
                    x: e.touches[0].clientX - rect.left,
                    y: e.touches[0].clientY - rect.top
                };
            }
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        };

        const startDrawing = (e) => {
            setIsDrawing(true);
            const { x, y } = getCoords(e);
            ctx.beginPath();
            ctx.moveTo(x, y);
        };

        const draw = (e) => {
            if (!isDrawing) return;
            const { x, y } = getCoords(e);
            ctx.lineTo(x, y);
            ctx.strokeStyle = drawingColor;
            ctx.stroke();
        };

        const stopDrawing = () => {
            setIsDrawing(false);
            ctx.closePath();
        };

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing); // Stop drawing if mouse leaves canvas

        // Touch events for mobile
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('touchcancel', stopDrawing);

        return () => {
            canvas.removeEventListener('mousedown', startDrawing);
            canvas.removeEventListener('mousemove', draw);
            canvas.removeEventListener('mouseup', stopDrawing);
            canvas.removeEventListener('mouseout', stopDrawing);

            canvas.removeEventListener('touchstart', startDrawing);
            canvas.removeEventListener('touchmove', draw);
            canvas.removeEventListener('touchend', stopDrawing);
            canvas.removeEventListener('touchcancel', stopDrawing);
        };
    }, [isDrawing, drawingColor]);

    const clearCanvas = () => {
        const canvas = canvasRef.current;
        if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    };

    const handleQuizChange = (question, answer) => {
        setQuizAnswers(prev => ({ ...prev, [question]: answer }));
    };

    const submitQuiz = () => {
        setShowQuizResult(true);
    };

    const getQuizFeedback = (questionKey, correctAnswer) => {
        if (showQuizResult) {
            const userAnswer = quizAnswers[questionKey];
            if (userAnswer === null) return <span className="text-gray-500">未作答</span>;
            return userAnswer === correctAnswer ? (
                <span className="text-green-400">正確！</span>
            ) : (
                <span className="text-red-400">錯誤！</span>
            );
        }
        return null;
    };

    const creators = [
        {
            name: 'DEBE',
            category: '塗鴉',
            image: 'https://placehold.co/150x150/8A2BE2/FFFFFF?text=DEBE',
            description: '台灣塗鴉藝術的先驅之一，以其獨特的風格和對文字的掌握聞名。',
            link: '#'
        },
        {
            name: 'MR.OGAY',
            category: '塗鴉',
            image: 'https://placehold.co/150x150/FF4500/FFFFFF?text=MR.OGAY',
            description: '台灣街頭藝術家，作品充滿幽默感和社會批判。',
            link: '#'
        },
        {
            name: 'Dwagie (大支)',
            category: 'Rapper',
            image: 'https://placehold.co/150x150/008000/FFFFFF?text=大支',
            description: '台灣嘻哈音樂的代表人物，以其犀利的歌詞和社會議題的關注而聞名。',
            link: '#'
        },
        {
            name: 'DJ RayRay',
            category: 'DJ',
            image: 'https://placehold.co/150x150/ADD8E6/FFFFFF?text=DJ+RayRay',
            description: '國際知名的台灣女DJ，活躍於各大音樂節。',
            link: '#'
        },
    ];

    const [filteredCategory, setFilteredCategory] = useState('All');

    const filteredCreators = filteredCategory === 'All'
        ? creators
        : creators.filter(creator => creator.category === filteredCategory);

    const navItems = [
        { id: 'home', label: '首頁' },
        { id: 'hiphop-intro', label: '嘻哈文化簡介' },
        { id: 'graffiti-intro', label: '街頭塗鴉入門' },
        { id: 'norms-taboos', label: '文化規範與禁忌' },
        { id: 'graffiti-skills', label: '塗鴉技巧教學' },
        { id: 'creators', label: '台灣知名創作者' },
        { id: 'resources', label: '延伸閱讀與資源' },
    ];

    const renderSection = () => {
        switch (currentSection) {
            case 'home':
                return (
                    <div className="relative h-screen flex flex-col items-center justify-center text-white p-4 overflow-hidden">
                        {/* Background animation/gradient */}
                        <div className="absolute inset-0 bg-gradient-to-br from-black via-purple-900 to-red-900 opacity-90 z-0 animate-fade-in"></div>
                        <div className="absolute inset-0 bg-[url('https://placehold.co/1920x1080/000000/FFFFFF?text=GRAFFITI+WALL')] bg-cover bg-center opacity-20 z-0 animate-pulse-slow"></div>

                        <div className="relative z-10 text-center">
                            <h1 className="text-6xl md:text-8xl font-extrabold tracking-tight mb-4 text-shadow-neon animate-slide-in-top">
                                街頭塗鴉與嘻哈文化
                            </h1>
                            <p className="text-2xl md:text-3xl font-light mb-8 text-shadow-neon animate-slide-in-bottom">
                                深入探索街頭藝術的脈動與精神
                            </p>
                            <div className="flex flex-wrap justify-center gap-4">
                                {navItems.filter(item => item.id !== 'home').map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => setCurrentSection(item.id)}
                                        className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out border-2 border-green-400 animate-bounce-in"
                                    >
                                        {item.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            case 'hiphop-intro':
                return (
                    <div className="p-8 bg-black text-white min-h-screen">
                        <h2 className="text-4xl font-bold mb-6 text-purple-400 border-b-2 border-purple-600 pb-2">嘻哈文化簡介</h2>
                        <div className="space-y-6 text-lg">
                            <p>
                                嘻哈（Hip-Hop）文化起源於1970年代紐約布朗克斯區的街頭派對，最初是作為一種回應社會壓迫和貧困的文化表達形式。它不僅僅是一種音樂類型，更是一種包含生活方式、藝術形式和價值觀的綜合文化現象。
                            </p>
                            <h3 className="text-3xl font-semibold text-green-400">嘻哈的四大元素：</h3>
                            <ul className="list-disc list-inside space-y-2 ml-4">
                                <li>
                                    <span className="font-bold text-red-400">MC (Master of Ceremonies) / Rapping：</span>
                                    饒舌，透過節奏和韻律來表達故事、觀點和情感。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">DJ (Disc Jockey) / DJing：</span>
                                    唱片騎師，透過混音、刮盤和節奏創造新的音樂體驗。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">Breaking / B-boying/B-girling：</span>
                                    霹靂舞，一種充滿力量、技巧和創造力的街舞形式。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">Graffiti / 塗鴉：</span>
                                    街頭塗鴉，在公共空間進行的視覺藝術創作，常與嘻哈音樂和街舞緊密結合。
                                </li>
                            </ul>
                            <h3 className="text-3xl font-semibold text-green-400">嘻哈的精神與價值觀：</h3>
                            <p>
                                嘻哈文化強調「自我表達」、「反叛精神」和「社群連結」。它鼓勵個體通過藝術形式發出自己的聲音，挑戰既有體制，並在社群中建立起強烈的歸屬感和認同。從街頭到全球，嘻哈不斷演變，但其核心的創造力、韌性和真實性始終不變。
                            </p>
                        </div>
                    </div>
                );
            case 'graffiti-intro':
                return (
                    <div className="p-8 bg-black text-white min-h-screen">
                        <h2 className="text-4xl font-bold mb-6 text-purple-400 border-b-2 border-purple-600 pb-2">街頭塗鴉入門</h2>
                        <div className="space-y-6 text-lg">
                            <p>
                                街頭塗鴉（Graffiti）作為嘻哈文化的視覺元素之一，其歷史可以追溯到古文明時期，但現代塗鴉的興起則與1970年代紐約的街頭文化息息相關。最初，塗鴉是青少年在地鐵車廂和牆壁上留下個人標記（Tag）的方式，逐漸演變為複雜的藝術形式。
                            </p>
                            <h3 className="text-3xl font-semibold text-green-400">塗鴉與破壞公物的區別：</h3>
                            <p>
                                塗鴉藝術與破壞公物之間存在明確的界線。合法的塗鴉藝術是在獲得許可的空間（如合法塗鴉牆、藝術專案）上進行創作，它被視為一種公共藝術形式，為城市增添色彩和活力。而未經許可在私人或公共財產上進行的塗鴉，則屬於破壞公物行為，會面臨法律後果。
                            </p>
                            <h3 className="text-3xl font-semibold text-green-400">合法塗鴉牆介紹：</h3>
                            <p>
                                為了推廣街頭藝術並提供創作者合法表達的空間，許多城市都設有合法塗鴉牆。這些地點通常會定期更新，吸引來自各地的塗鴉藝術家前來創作。在台灣，一些知名地點如台北的寶藏巖國際藝術村、華山文創園區周邊，以及高雄駁二藝術特區等地，都曾有或設有合法塗鴉區域，鼓勵藝術家在指定範圍內自由創作。
                                <br />
                                <span className="text-sm text-gray-400">(註：本頁面不提供即時地圖標記，請參考延伸閱讀區塊獲取最新資訊。)</span>
                            </p>
                        </div>
                    </div>
                );
            case 'norms-taboos':
                return (
                    <div className="p-8 bg-black text-white min-h-screen">
                        <h2 className="text-4xl font-bold mb-6 text-purple-400 border-b-2 border-purple-600 pb-2">文化規範與禁忌</h2>
                        <div className="space-y-6 text-lg">
                            <p className="mb-8">
                                街頭塗鴉文化有其獨特的「街頭禮儀」和不成文的規範。尊重這些規則對於維護社群和藝術的健康發展至關重要。
                            </p>

                            <h3 className="text-3xl font-semibold text-green-400 mb-4">互動小測驗</h3>
                            <div className="bg-gray-800 p-6 rounded-lg shadow-lg mb-8">
                                <div className="mb-6">
                                    <p className="font-bold mb-2">1. 在塗鴉牆上，你可以直接覆蓋其他人的作品，特別是新手或名氣較小的藝術家。</p>
                                    <div className="flex gap-4">
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                name="q1"
                                                value="false"
                                                checked={quizAnswers.q1 === 'false'}
                                                onChange={() => handleQuizChange('q1', 'false')}
                                                className="form-radio text-green-500"
                                            />
                                            <span className="ml-2">是</span>
                                        </label>
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                name="q1"
                                                value="true"
                                                checked={quizAnswers.q1 === 'true'}
                                                onChange={() => handleQuizChange('q1', 'true')}
                                                className="form-radio text-red-500"
                                            />
                                            <span className="ml-2">否</span>
                                        </label>
                                    </div>
                                    {getQuizFeedback('q1', 'true')}
                                </div>

                                <div className="mb-6">
                                    <p className="font-bold mb-2">2. 塗鴉時應避免使用帶有政治、宗教或歧視意味的圖案和文字。</p>
                                    <div className="flex gap-4">
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                name="q2"
                                                value="true"
                                                checked={quizAnswers.q2 === 'true'}
                                                onChange={() => handleQuizChange('q2', 'true')}
                                                className="form-radio text-green-500"
                                            />
                                            <span className="ml-2">是</span>
                                        </label>
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                name="q2"
                                                value="false"
                                                checked={quizAnswers.q2 === 'false'}
                                                onChange={() => handleQuizChange('q2', 'false')}
                                                className="form-radio text-red-500"
                                            />
                                            <span className="ml-2">否</span>
                                        </label>
                                    </div>
                                    {getQuizFeedback('q2', 'true')}
                                </div>

                                <div className="mb-6">
                                    <p className="font-bold mb-2">3. 在非合法塗鴉地點進行創作，若被發現將可能面臨法律責任。</p>
                                    <div className="flex gap-4">
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                name="q3"
                                                value="true"
                                                checked={quizAnswers.q3 === 'true'}
                                                onChange={() => handleQuizChange('q3', 'true')}
                                                className="form-radio text-green-500"
                                            />
                                            <span className="ml-2">是</span>
                                        </label>
                                        <label className="inline-flex items-center">
                                            <input
                                                type="radio"
                                                name="q3"
                                                value="false"
                                                checked={quizAnswers.q3 === 'false'}
                                                onChange={() => handleQuizChange('q3', 'false')}
                                                className="form-radio text-red-500"
                                            />
                                            <span className="ml-2">否</span>
                                        </label>
                                    </div>
                                    {getQuizFeedback('q3', 'true')}
                                </div>

                                <button
                                    onClick={submitQuiz}
                                    className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transform hover:scale-105 transition duration-300 ease-in-out"
                                >
                                    提交測驗
                                </button>
                            </div>

                            <h3 className="text-3xl font-semibold text-green-400 mb-4">插畫式案例說明 (概念)</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-gray-800 p-6 rounded-lg shadow-lg border-l-4 border-green-500">
                                    <p className="font-bold text-xl mb-2 text-green-400">✅ 尊重文化行為：</p>
                                    <ul className="list-disc list-inside space-y-2">
                                        <li>在合法塗鴉牆上創作。</li>
                                        <li>不抄襲他人作品，發展自己的風格。</li>
                                        <li>尊重先來者的作品，不隨意覆蓋。</li>
                                        <li>保持創作環境的清潔。</li>
                                    </ul>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg shadow-lg border-l-4 border-red-500">
                                    <p className="font-bold text-xl mb-2 text-red-400">❌ 冒犯文化行為：</p>
                                    <ul className="list-disc list-inside space-y-2">
                                        <li>在私人財產或非合法地點塗鴉。</li>
                                        <li>惡意破壞或覆蓋他人作品（尤其是有名氣的藝術家）。</li>
                                        <li>使用歧視、侮辱或政治敏感內容。</li>
                                        <li>亂丟噴漆罐或其他垃圾。</li>
                                    </ul>
                                </div>
                            </div>
                            <p className="mt-8 text-red-400">
                                <span className="font-bold">重要提示：</span>
                                在非合法地點塗鴉可能導致罰款、社區服務甚至刑事責任。請務必遵守當地法律法規。
                            </p>
                        </div>
                    </div>
                );
            case 'graffiti-skills':
                return (
                    <div className="p-8 bg-black text-white min-h-screen">
                        <h2 className="text-4xl font-bold mb-6 text-purple-400 border-b-2 border-purple-600 pb-2">塗鴉技巧教學</h2>
                        <div className="space-y-6 text-lg">
                            <h3 className="text-3xl font-semibold text-green-400">工具介紹：</h3>
                            <ul className="list-disc list-inside space-y-2 ml-4">
                                <li>
                                    <span className="font-bold text-red-400">噴漆種類：</span>
                                    常見的有藝術級噴漆（如 Montana, Belton Molotow），顏色豐富，壓力穩定。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">噴嘴 (Caps)：</span>
                                    不同噴嘴能產生不同線條粗細和噴霧效果（如細線嘴、肥線嘴、平頭嘴）。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">保護裝備：</span>
                                    手套、口罩（防毒面具）、護目鏡，保護身體免受化學物質侵害。
                                </li>
                            </ul>

                            <h3 className="text-3xl font-semibold text-green-400">線條與陰影技巧：</h3>
                            <ul className="list-disc list-inside space-y-2 ml-4">
                                <li>
                                    <span className="font-bold text-red-400">線條控制：</span>
                                    透過噴漆距離和移動速度控制線條的粗細和均勻度。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">陰影與立體感：</span>
                                    使用深色噴漆在字體邊緣或底部添加陰影，營造立體效果。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">漸層：</span>
                                    使用兩種或多種顏色，透過噴漆的疊加和融合創造平滑的漸層效果。
                                </li>
                            </ul>

                            <h3 className="text-3xl font-semibold text-green-400">基本字體：</h3>
                            <ul className="list-disc list-inside space-y-2 ml-4">
                                <li>
                                    <span className="font-bold text-red-400">Tag (簽名)：</span>
                                    塗鴉藝術家最基本的個人標誌，通常是快速書寫的簽名。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">Throw-up (泡泡字)：</span>
                                    比 Tag 更大、更具造型的字體，通常由簡單的線條和兩三種顏色組成。
                                </li>
                                <li>
                                    <span className="font-bold text-red-400">Piece (大作)：</span>
                                    最複雜、最精緻的塗鴉作品，通常包含多種顏色、立體效果、背景和角色。
                                </li>
                            </ul>

                            <h3 className="text-3xl font-semibold text-green-400 mt-8 mb-4">練習模擬區：</h3>
                            <p className="mb-4">
                                在下方畫布上嘗試練習您的塗鴉技巧！選擇顏色並拖動滑鼠或手指進行繪畫。
                            </p>
                            <div className="flex flex-col items-center bg-gray-800 p-4 rounded-lg shadow-lg">
                                <div className="flex gap-4 mb-4">
                                    <button
                                        onClick={() => setDrawingColor('#00ff00')}
                                        className="w-10 h-10 rounded-full bg-green-500 border-2 border-green-300 hover:scale-110 transition-transform"
                                        title="綠色"
                                    ></button>
                                    <button
                                        onClick={() => setDrawingColor('#ff0000')}
                                        className="w-10 h-10 rounded-full bg-red-500 border-2 border-red-300 hover:scale-110 transition-transform"
                                        title="紅色"
                                    ></button>
                                    <button
                                        onClick={() => setDrawingColor('#0000ff')}
                                        className="w-10 h-10 rounded-full bg-blue-500 border-2 border-blue-300 hover:scale-110 transition-transform"
                                        title="藍色"
                                    ></button>
                                    <button
                                        onClick={() => setDrawingColor('#ffff00')}
                                        className="w-10 h-10 rounded-full bg-yellow-500 border-2 border-yellow-300 hover:scale-110 transition-transform"
                                        title="黃色"
                                    ></button>
                                    <button
                                        onClick={() => setDrawingColor('#ffffff')}
                                        className="w-10 h-10 rounded-full bg-white border-2 border-gray-300 hover:scale-110 transition-transform"
                                        title="白色"
                                    ></button>
                                    <button
                                        onClick={() => setDrawingColor('#000000')}
                                        className="w-10 h-10 rounded-full bg-black border-2 border-gray-600 hover:scale-110 transition-transform"
                                        title="黑色"
                                    ></button>
                                </div>
                                <canvas
                                    ref={canvasRef}
                                    width={800}
                                    height={400}
                                    className="border-2 border-purple-500 rounded-lg bg-gray-900 w-full max-w-full h-auto"
                                    style={{ touchAction: 'none' }} // Prevent scrolling on touch devices while drawing
                                ></canvas>
                                <button
                                    onClick={clearCanvas}
                                    className="mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transform hover:scale-105 transition duration-300 ease-in-out"
                                >
                                    清除畫布
                                </button>
                            </div>
                        </div>
                    </div>
                );
            case 'creators':
                return (
                    <div className="p-8 bg-black text-white min-h-screen">
                        <h2 className="text-4xl font-bold mb-6 text-purple-400 border-b-2 border-purple-600 pb-2">台灣知名塗鴉／嘻哈創作者</h2>
                        <div className="mb-6 flex flex-wrap gap-4">
                            <button
                                onClick={() => setFilteredCategory('All')}
                                className={`py-2 px-4 rounded-full font-bold transition duration-300 ${filteredCategory === 'All' ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                            >
                                全部
                            </button>
                            <button
                                onClick={() => setFilteredCategory('塗鴉')}
                                className={`py-2 px-4 rounded-full font-bold transition duration-300 ${filteredCategory === '塗鴉' ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                            >
                                塗鴉藝術家
                            </button>
                            <button
                                onClick={() => setFilteredCategory('Rapper')}
                                className={`py-2 px-4 rounded-full font-bold transition duration-300 ${filteredCategory === 'Rapper' ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                            >
                                Rapper
                            </button>
                            <button
                                onClick={() => setFilteredCategory('DJ')}
                                className={`py-2 px-4 rounded-full font-bold transition duration-300 ${filteredCategory === 'DJ' ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                            >
                                DJ
                            </button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredCreators.map((creator, index) => (
                                <div key={index} className="bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col items-center text-center border border-purple-700 transform hover:scale-105 transition duration-300 ease-in-out">
                                    <img
                                        src={creator.image}
                                        alt={creator.name}
                                        className="w-32 h-32 rounded-full object-cover mb-4 border-4 border-green-500 shadow-md"
                                        onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/150x150/808080/FFFFFF?text=${creator.name}`; }}
                                    />
                                    <h3 className="text-2xl font-bold text-red-400 mb-2">{creator.name}</h3>
                                    <p className="text-purple-300 mb-2">類別: {creator.category}</p>
                                    <p className="text-gray-300 text-sm mb-4">{creator.description}</p>
                                    <a
                                        href={creator.link}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full shadow-md transition duration-300"
                                    >
                                        了解更多
                                    </a>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            case 'resources':
                return (
                    <div className="p-8 bg-black text-white min-h-screen">
                        <h2 className="text-4xl font-bold mb-6 text-purple-400 border-b-2 border-purple-600 pb-2">延伸閱讀與資源</h2>
                        <div className="space-y-8 text-lg">
                            <div>
                                <h3 className="text-3xl font-semibold text-green-400 mb-4">書單推薦：</h3>
                                <ul className="list-disc list-inside space-y-2 ml-4">
                                    <li>《塗鴉藝術：從街頭到美術館》</li>
                                    <li>《嘻哈聖經：從布朗克斯到全球的文化旅程》</li>
                                    <li>《台灣街頭塗鴉觀察報告》</li>
                                </ul>
                            </div>
                            <div>
                                <h3 className="text-3xl font-semibold text-green-400 mb-4">紀錄片與訪談影片：</h3>
                                <ul className="list-disc list-inside space-y-2 ml-4">
                                    <li>《Style Wars》 (經典塗鴉紀錄片)</li>
                                    <li>《Hip-Hop Evolution》 (Netflix 紀錄片系列)</li>
                                    <li>台灣塗鴉藝術家訪談系列 (可在 YouTube 搜尋)</li>
                                </ul>
                            </div>
                            <div>
                                <h3 className="text-3xl font-semibold text-green-400 mb-4">合法塗鴉牆位置與藝術活動資訊：</h3>
                                <ul className="list-disc list-inside space-y-2 ml-4">
                                    <li>請關注各地文化局或藝術中心的官方網站，獲取最新的合法塗鴉牆資訊。</li>
                                    <li>台灣街頭藝術節、塗鴉展覽等活動資訊可透過藝術媒體或社群平台查詢。</li>
                                </ul>
                            </div>
                            <div>
                                <h3 className="text-3xl font-semibold text-green-400 mb-4">嘻哈相關課程／社群推薦：</h3>
                                <ul className="list-disc list-inside space-y-2 ml-4">
                                    <li>Instagram 標籤：#台灣塗鴉 #街頭藝術 #嘻哈文化 #台灣饒舌</li>
                                    <li>Facebook 社團：搜尋「台灣嘻哈」、「塗鴉藝術」相關社團加入。</li>
                                    <li>實體課程：部分舞蹈教室或藝術工作室會開設 Breaking 或塗鴉基礎課程。</li>
                                    <li>街頭市集：關注各地文創市集或音樂節，常有嘻哈相關的攤位或表演。</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                );
            default:
                return null;
        }
    };

    return (
        <div className="min-h-screen bg-black font-inter">
            {/* Tailwind CSS Script for JIT mode and custom fonts */}
            <script src="https://cdn.tailwindcss.com"></script>
            <style>
                {`
                @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
                @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap'); /* For street style font */
                
                body {
                    font-family: 'Inter', sans-serif;
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                    overflow-x: hidden; /* Prevent horizontal scrolling */
                }
                
                .font-inter {
                    font-family: 'Inter', sans-serif;
                }

                .font-permanent-marker {
                    font-family: 'Permanent Marker', cursive;
                }

                /* Neon text shadow for titles */
                .text-shadow-neon {
                    text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 15px #00ffff, 0 0 20px #00ffff;
                }

                /* Custom animations */
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                .animate-fade-in {
                    animation: fadeIn 1s ease-out forwards;
                }

                @keyframes slideInTop {
                    from { transform: translateY(-50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                .animate-slide-in-top {
                    animation: slideInTop 1s ease-out forwards;
                }

                @keyframes slideInBottom {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                .animate-slide-in-bottom {
                    animation: slideInBottom 1s ease-out forwards;
                    animation-delay: 0.3s; /* Delay for sequential animation */
                }

                @keyframes pulseSlow {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                }
                .animate-pulse-slow {
                    animation: pulseSlow 8s infinite ease-in-out;
                }

                @keyframes bounceIn {
                    0% { transform: scale(0.3); opacity: 0; }
                    50% { transform: scale(1.05); opacity: 1; }
                    70% { transform: scale(0.9); }
                    100% { transform: scale(1); }
                }
                .animate-bounce-in {
                    animation: bounceIn 0.8s ease-out forwards;
                }
                .animate-bounce-in:nth-child(1) { animation-delay: 0.6s; }
                .animate-bounce-in:nth-child(2) { animation-delay: 0.7s; }
                .animate-bounce-in:nth-child(3) { animation-delay: 0.8s; }
                .animate-bounce-in:nth-child(4) { animation-delay: 0.9s; }
                .animate-bounce-in:nth-child(5) { animation-delay: 1.0s; }
                .animate-bounce-in:nth-child(6) { animation-delay: 1.1s; }
                .animate-bounce-in:nth-child(7) { animation-delay: 1.2s; }

                /* Custom scrollbar for better aesthetics */
                ::-webkit-scrollbar {
                    width: 10px;
                }
                ::-webkit-scrollbar-track {
                    background: #2d3748; /* Dark gray */
                    border-radius: 5px;
                }
                ::-webkit-scrollbar-thumb {
                    background: #8A2BE2; /* Purple */
                    border-radius: 5px;
                }
                ::-webkit-scrollbar-thumb:hover {
                    background: #6A1BA2; /* Darker purple */
                }
                `}
            </style>

            {/* Navigation Bar */}
            <nav className="bg-gray-900 p-4 shadow-lg sticky top-0 z-20">
                <div className="container mx-auto flex flex-wrap justify-between items-center">
                    <div className="text-white text-2xl font-bold font-permanent-marker tracking-wide">
                        <span className="text-green-400">GRAF</span><span className="text-red-400">CULTURE</span>
                    </div>
                    <div className="flex flex-wrap gap-2 md:gap-4 mt-2 md:mt-0">
                        {navItems.map(item => (
                            <button
                                key={item.id}
                                onClick={() => setCurrentSection(item.id)}
                                className={`py-2 px-3 md:px-4 rounded-full text-sm md:text-base font-semibold transition duration-300 ease-in-out transform hover:scale-105
                                    ${currentSection === item.id ? 'bg-purple-600 text-white shadow-md' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                            >
                                {item.label}
                            </button>
                        ))}
                    </div>
                </div>
            </nav>

            {/* User ID Display (for Firestore context) */}
            {userId && (
                <div className="bg-gray-800 text-gray-400 text-xs p-2 text-center break-all">
                    使用者 ID: {userId}
                    {/* This userId is crucial for Firestore security rules to identify the user's private data path. */}
                </div>
            )}

            {/* Main Content Area */}
            <main className="container mx-auto py-8 px-4">
                {renderSection()}
            </main>

            {/* Footer */}
            <footer className="bg-gray-900 p-6 text-center text-gray-400 text-sm mt-12">
                <p>&copy; 2024 街頭塗鴉與嘻哈文化入門指南. All rights reserved.</p>
                <p>為推廣街頭藝術文化而生。</p>
            </footer>
        </div>
    );
}

export default App;
